function KindlingFixture(a){if(!_.isArray(a.fixtures)){a.fixtures=[];var b=_.extend(_.clone(a.model),{id:0});_.each(a.model,function(a,c){var d=c.toLowerCase();switch(a._meta.type){case"string":b[c]=-1!=d.indexOf("email")?"foo@foo.com":-1!=d.indexOf("phone")?"1-123-123-1234":-1!=d.indexOf("postal")?"M1M 1M1":-1!=d.indexOf("zip")?"12345":"foo";break;case"number":b[c]=-1!=d.indexOf("phone")?"1-123-123-1234":-1!=d.indexOf("zip")?"12345":1;break;case"boolean":b[c]=!0;break;case"date":b[c]=new Date;break;case"hasMany":case"belongsTo":}});for(var c=1;5>=c;c++)b.id=c,a.fixtures.push(_.clone(b))}return a.fixtures}function KindlingSpark(a,b){var c={},d={get:function(a){return c[a]},add:function(d,e){if(c[d])Ember.Logger.warn("Attempting to add a duplicate spark, bypassed: "+d);else{var f=d===b.lcPlural||d===b.ucPlural,g=d.ucwords(),h=(f?b.ucPlural:g===b.uc?"":b.uc)+(b.ucPlural!=g?g:""),i=h+"Controller",j=h+"Route",k=h+"View";if(Ember.Logger.log("Spark attrs: "+j+", "+i+", "+k),_.isObject(e.ctrl))switch(e.ctrl._type||"ctrl"){case"arrctrl":case"arrCtrl":case"arrcontroller":case"arrController":case"arrayctrl":case"arrayCtrl":case"arraycontroller":case"arrayController":case"ArrayController":a[i]=Ember.ArrayController.extend(e.ctrl);break;case"objctrl":case"objCtrl":case"objcontroller":case"objController":case"objectctrl":case"objectCtrl":case"objectcontroller":case"objectController":case"ObjectController":a[i]=Ember.ObjectController.extend(e.ctrl);break;default:a[i]=Ember.Controller.extend(e.ctrl)}switch(_.isObject(e.route)&&(a[j]=Ember.Route.extend(e.route)),e.view=_.defaults(e.view||{},{tagName:"div",classNames:[k]}),e.view._type||"view"){case"colview":case"colView":case"colllectionview":case"colllectionView":case"ColllectionView":a[k]=Ember.CollectionView.extend(e.view);break;case"conview":case"conView":case"containerview":case"containerView":case"ContainerView":a[k]=Ember.ContainerView.extend(e.view);break;default:a[k]=Ember.View.extend(e.view)}_.isNull(e.map)||_.isFunction(e.map)||(Ember.Logger.log("Route mapping for spark: "+h+", /"+b.lc+"/"+d),e.map=function(){this.resource(b.lc,function(){this.route(d)})}),_.isFunction(e.map)&&a.Router.map(e.map),c[d]={route:function(){return a[j]},ctrl:function(){return a[i]},view:function(){return a[k]}}}}};return d}_.mixin({stringify:function(a){return JSON.stringify(a)}}),String.prototype.ucwords=function(){return this.toLowerCase().replace(/^.|\s\S/g,function(a){return a.toUpperCase()})},String.prototype.lastChar=function(){return this.charAt(this.length-1)},String.prototype.pluralize=function(){return"y"===this.lastChar()?this.charAt(this.length-2).isVowel()?this+"s":this.slice(0,-1)+"ies":"us"===this.substring(this.length-2)?this.slice(0,-2)+"i":-1!==["ch","sh"].indexOf(this.substring(this.length-2))||-1!==["x","s"].indexOf(this.lastChar())?this+"es":this+"s"},Handlebars.registerHelper("toHtml",function(a){return new Handlebars.SafeString(a)}),Kindling=function(a){var b=function(b,c,d){var e={lc:b.toLowerCase(),uc:b.ucwords(),lcPlural:b.toLowerCase().pluralize(),ucPlural:b.ucwords().pluralize(),spark:""},f={names:e,opts:d,model:function(){return a[e.uc]},modelFields:function(){return Ember.get(a[e.uc],"fields")},router:function(){return a.Router},routesMapped:[],sparks:KindlingSpark(a,e)};return a[e.uc]=DS.Model.extend(d.model||{}),f.model().reopen({attributes:function(){var a=this;return Ember.keys(this.get("data")).map(function(b){return Em.Object.create({model:a,key:b,valueBinding:"model."+b})})}.property().readOnly()}).FIXTURES=KindlingFixture(d),_.isObject(d.sparks)&&_.each(d.sparks,function(a,b){f.sparks.add(b,a)}),f.sparks.add(e.lcPlural,{route:{model:function(){return this.store.find(e.lc)}},ctrl:{_type:"arrctrl",sortProperties:[c],sortAscending:!1,totalItems:function(){return this.store.find(e.lc).get("length")}.property(e.lc+".@each.id")},map:null}),f.sparks.add(e.lc,{route:{model:function(a){return this.store.find(e.lc,a[c])}},ctrl:{_type:"objctrl"},map:null}),f.sparks.add("edit",{route:{model:function(){return this.store.find(e.lc,this.modelFor(e.lc).id)},setupController:function(a,b){a.set("model",b);var c=b.get("attributes").map(function(a){return{key:a.get("key"),value:a.get("value")}});a.set("buffer",c)}},ctrl:{_type:"objctrl",needs:e.lc,actions:{save:function(){var a=this;this.get("buffer").forEach(function(b){a.get("controllers."+e.lc+".model").set(b.key,b.value)}),this.transitionToRoute("user",this.get("model"))}}},map:null}),f.sparks.add("create",{route:{setupController:function(a,b){a.set("model",b);var c=b.get("attributes").map(function(a){return{key:a.get("key"),value:a.get("value")}});a.set("buffer",c)}},ctrl:{_type:"objctrl",needs:e.lc,actions:{save:function(){var a=this;this.get("buffer").forEach(function(b){a.get("controllers."+e.lc+".model").set(b.key,b.value)}),this.transitionToRoute("user",this.get("model"))}}}}),f.router().map(function(){this.resource(e.lcPlural),this.resource(e.lc,{path:"/"+e.lc+"/:"+c},function(){this.route("edit")})}),Ember.Logger.log("Kindling %O",f),f};return b};